# Quality Scale for Light Controller Integration
# https://developers.home-assistant.io/docs/integration_quality_scale_index/
#
# This integration is a "service" type that provides light control services
# with verification and preset management. It doesn't poll devices or
# communicate with external APIs.

rules:
  # =========================================================================
  # Bronze (Mandatory for all integrations)
  # =========================================================================

  # Has config flow for UI setup
  config-flow: done

  # All entities have unique IDs for registry tracking
  entity-unique-id: done

  # Services are registered in async_setup, not async_setup_entry
  action-setup: done

  # Services raise ServiceValidationError/HomeAssistantError
  action-exceptions: done

  # Has English translations in strings.json
  has-translations: done

  # Uses runtime_data pattern (HA 2024.4+)
  runtime-data: done

  # Properly unloads platforms in async_unload_entry
  config-entry-unloading: done

  # Uses appropriate logging (_LOGGER, no print statements)
  log-when-unavailable:
    status: exempt
    comment: Integration doesn't communicate with devices directly.

  # Constants in const.py, logic in controller.py/preset_manager.py
  common-modules: done

  # 315 tests, 98%+ coverage including config flow
  config-flow-test-coverage: done

  # requirements: [] in manifest.json, dependencies declared
  dependency-transparency: done

  # README.md has HACS and manual installation instructions
  docs-installation-instructions: done

  # No polling; iot_class: calculated
  appropriate-polling:
    status: exempt
    comment: No polling; iot_class is calculated.

  # Listeners registered in async_added_to_hass with async_on_remove
  entity-event-setup: done

  # Both entities set _attr_has_entity_name = True with translation_key
  has-entity-name: done

  # codeowners in manifest.json
  integration-owner: done

  # async_set_unique_id(DOMAIN) + _abort_if_unique_id_configured()
  unique-config-entry: done

  # No external connection to test
  test-before-configure:
    status: exempt
    comment: Service integration with no external connections.

  test-before-setup:
    status: exempt
    comment: No external API/device to validate during setup.

  # 315 tests at 98%+ branch coverage
  test-coverage: done

  # =========================================================================
  # Silver (Enhanced functionality)
  # =========================================================================

  # Both entities implement available property checking preset existence
  entity-unavailable: done

  # PARALLEL_UPDATES = 0 set in both platform files
  parallel-updates: done

  # Supports reauthentication flow
  reauthentication-flow:
    status: exempt
    comment: No authentication required; integration is local-only.

  # =========================================================================
  # Gold (Advanced features)
  # =========================================================================

  # Both entities return DeviceInfo with identifiers
  devices: done

  # diagnostics.py with config entry diagnostics
  diagnostics: done

  # Supports device discovery (zeroconf, dhcp, etc.)
  discovery:
    status: exempt
    comment: No discoverable devices; service-only integration.

  # Dynamic entity addition when new devices appear
  dynamic-devices:
    status: done
    comment: Preset entities are dynamically added/removed via listener pattern.

  # Supports options flow for reconfiguration
  reconfiguration-flow: done

  # Entities have appropriate entity categories
  entity-category:
    status: exempt
    comment: Preset buttons/sensors are user-facing, not diagnostic.

  # Entity translations in strings.json
  entity-translations: done

  # Exception translations with translation_domain/translation_key
  exception-translations: done

  # icons.json provides state-based icons for sensor, default for button
  icon-translations: done

  # =========================================================================
  # Platinum (Highest quality)
  # =========================================================================

  # All dependencies are async
  async-dependency:
    status: exempt
    comment: No external dependencies; uses only HA core.

  # Strict typing with py.typed marker
  strict-typing:
    status: todo
    comment: Could add py.typed and ensure mypy strict compliance.

  # Injects web session to dependencies
  inject-websession:
    status: exempt
    comment: No HTTP communication required.

  # Stale device removal
  stale-devices:
    status: exempt
    comment: No physical devices to become stale.
